# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

# GitHub recommends pinning actions to a commit SHA.
# To get a newer version, you will need to update the SHA.
# You can also reference a tag or branch, but the action may change without warning.

name: Build and deploy JAR app to Azure Web App

env:
  AZURE_WEBAPP_NAME: MY_WEBAPP_NAME   # set this to your application's name
  JAVA_VERSION: '11'                  # set this to the Java version to use

on:
  pull_request:
    branches:
      - develop

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Java version
        uses: actions/setup-java@v4
        with:
          java-version: ${{ env.JAVA_VERSION }}
          distribution: 'temurin'
          cache: 'maven'

      - name: Build with Maven
        run: mvn clean install

      - name: Upload artifact for deployment job
        uses: actions/upload-artifact@v4
        with:
          name: java-app
          path: '${{ github.workspace }}/target/*.jar'

  deploy:
    runs-on: ubuntu-latest
    needs: build
    environment:
      name: 'production'
      url: ${{ steps.deploy-to-webapp.outputs.webapp-url }}

    steps:
      - name: Copy artifact to Azure VM
        uses: appleboy/scp-action@v0.1.7
        with:
          host: '135.235.137.133'
          username: 'github-pipeline'
          key: 'b3BlbnNzaC1rZXktdjEAAAAACmFlczI1Ni1jdHIAAAAGYmNyeXB0AAAAGAAAABAz1MucrJ
JmbjUsjClGgk0sAAAAGAAAAAEAAAIXAAAAB3NzaC1yc2EAAAADAQABAAACAQDRvI+uVZQG
aaBixED5gMia/VlK8GpzFBI3HymVNKpSj+hGmDBAGJVhuv6gRsmyJ2MrZg4VBcHlDzAI3D
sYfXOys4Kwjd36MmE2zsPW9MmAcYDATCCcGJuSeXlt2tFZ5JnyEVpw5B1K3nkKaqzq2AI3
pktlHme/fUo7VgRneL1uKMX7+go5Cv0qAnPl8OqHUCOxM5SJC1t5Tly/efviLFOo8cNOpo
bnsLhA1RmtgIDFXmIb2+gj2OlEbBMZoOz1yWQuweTjfdMe+2BeudlK1NZQM4I0l6SWyj1m
QZPpEK8z4+aqSH9/aDkc48/1AtZI3OSLnEc5PAtK2zmmr/LS5gfXX5onzQ4V3IILKYaIrU
3Wy/VjtQiLLiKeHxE4Zk6m8lV1yi1MzV2s7MQj7OnQA3+Xs0Tx9NYadgPANm6z2FQtkPHJ
+XiyFXqavL6E7DdtQ7v0ldgGICCkP2vRzP3kSGRUNhNoAObleUO0emwRvE/uw8b6O3q6QW
EhGVj2OnkA8hC8MH2s2F6FSMvbugH3QO1MngV3J1v0kcA5dCrJidS9eCwLANHkEqysvr9I
OHOY+blyr91SQZEtgVYogs8otS4kdYQtO353xjZuESDtiTIjAK//3SR2qfHP9D1EVoKB85
uvtSXatCLlWKHXm77KvSqdOmC+SAd58CRk7Ruiuz5XHwAAB2AdnV8fiz7ofOeWQc5cOg93
R43ZsSeO5aBpBXSadH2PSIOCHwWXuYpqQ6u+/SbdY7bIDiod9hagGo4XwrePmcesShNufB
hJVI0E2Mx3YlgBzZUi1PdR0GGpsHrqdrlQeHwmleQ3e9j+ZRnVVtWYcwezLVzKA+y8VW2H
mYdsfO3yQFwzFHh6wGhqcGAs92hn2uu9YTcSOy3CkSIZpWD0V9IHO/JofMsC0u9zJ156TR
3lX0aA6WfVtaaVIfPXmSsKasNHLwMNo6kq+CeMcz7LvnMF4MtdYxPy2YLk2ty4hCUPzjrp
hM3VUfzjaT9RWsaulr8NPmCTuaUbdPARJF+TMflTHFs2GqxaFk3gMGnzmeQg3gncipPulL
zoPfiylulM8EuS9jyFJaCpqnPUSVJX1DJNAEn6IMRZxWHOSaFrL8H+3S8b+YLpxniV+Eff
eZj7kTuIQ+apkKgWsq91rQKsPOtihXK6LsKgdw1ze9ojK4QFHdnGS8w2P3Fkx2iy+qBeOp
KJo26bSWqftqEn77a1S2cc9/McLypbSnYHvHazyL/cu3bKpK+RGqQSzkpdjOtnCkyW8WvG
SywqgztXR0NE/Wk1xu46rBqiHn1M9Mbjo14Uq77NfLeNhW9ECnpwWXfTdX8er/U1EROuhb
EmH3aQiRLc92Nc/UbQ65PvFN68qme/AYGKpwDQ7VjJYOlig/KX6ruw4FSXxEVHxtvKHJwG
FxgnMKsSh0FRMBP+B+lNJ5UOD4ksZpbv61V/rVjzoJfRY1CBzPPhHVizOl6uFEITTlEKfY
+SyHAxY6jQ2Q+hz93fTA13/8gHUR1IEWOO0GXB+5Dv6TOk8NPItjk2lsB1f9QpVW9SgfUk
945vDSK8F89YoI4+FsiEgpGdrVR+spLumI82EYnR+2z+MkIgJaj5NAKXlUuI6L0pDmrRN4
/KCqv4FMILkQfQCKuWOcQKZx5ry+/taQ0mcZDu2A2aAz4eP56roALQH6J9n9ztldM9UvOg
JTyitHBH5H0vYcNBsrCs5ME50Z/5H9LaQBhA2M7OuH0hEdUJ04g1krJhLHxnjy68ZLe3qv
7XTImbq+6n7gYXPK7H5MQBQBZ0v7yMZE5jcDp3ebHg/P6qAGA0h+Hl+PPHW5ivhH/kpacQ
L7syTXrfoWhU8l1oAFtKPQ/BuPDHn3iTi0WH3IGbkt7ztrjjTdgf8/Mt0FKIWJwUYxeJ/z
OnZJ20fac+D/8Voa4INxhYDnfrFwsWIziKEXSI41z8yTare0czPcKN22GbIxG1gu4IQb0L
idnfk2JWPTtYmuS5sLoaC0wv3wdiGQ76ZUaJOY+FFXHik5q2U7sTytPRt1fzXDI/aQZRuV
ZVA37nw2T8NQYWSPJax++gSn2zz89XX87O4cAAxVOEFwIqlHvdKgekBtA26QL28sz/sWVs
3ovxTM40Hs9mbyeXv0fk9kIGI2ZQMGOD09+qPnCAkcKFLS6BY6wLDx3hgHZBf2X0aagC4y
fw8n2S1beGGkCGpvyXvl5WdpRy2EzYRZ8PTZaxHrVTX3XD73uBqLLlMTBcFT6qJQ+qkZgc
T9hq5o7z+qspKcljbeq6AY6AEq2SH+JE1ZUN227phb0AJLTIoqUFQYwRMCKkPxJhWG/p98
qC/VVh/bT3p5GgIStb5pdWe4Zxxoe/sku3FFra2Mz4eBHTHS1k4sb8yIItDYs2EnSCGcmf
ZHdFkGreMz32QnAK0frUSFcvd46ig8jZmSdTuY7MZ8plZlUh4+O2Gbl0fuVBm2xL4CJo8t
srmNyMu6OLxoEUzT8ZpCMftyUOCryCARTaGi9hyonCzin+kOQ8/OvUwzTaIcq73MDbiJKI
TeqvI/hh96AAWYg4rBTKd7Gmn2qXn3gw8sVhLZnX14iHJtsTN8lGPFR0aENORIXTMsJuK+
iqom6TCvVm6rFkO/nkWxj3wWDSad2mZgZqoh4SE6Ucp7S221WgEtt7X6rU1PjL34tsnYOe
BWe3Y5DLOmNXzqNkAkM8Ma1VEkQn07ffJ+QmGaZO60pKliwcdMSIamVav6Os8uDkPLnxtv
ENqqIlO/Q67ekYqaMKxhdCPAyrZh6XHxPkF9r+9/wcfltehvL9B6+vnz8I4ZrQEZFn8UEu
0r/CVvvNDsWljk6YvNrCn2c6Aa4UulKqLKqO057SRJfdn8vbgJDt2K32YIt7vErk013s4k
bWr3U5prGIVMcTv85RocBlKrB9WANoYJ7bXkm8wIuZj+VZrGGKff6GDvTOyE1odMIWBRhK
ldTuG+rNdfTJeGp81aF7TOopujO7xX8Zi+rqC+E5+JMoSHd+GpXwLM6gLmytS8OaG72/cS
B0YptClyL/bRY0H6BVEVqRq/8kDS+9WBLACSdyi5JqvK8kyM3SsQ2ZuNY08EJbCKxo5UNq
4Fy5RPaNPrBbv4SZZh3ddZQeLTTLBvfKcZeDRE69SZ1Tr1EhjtUWcw/xQaSm3/S9uEKPWr
ioK0Lx5mmQW3fY5GetN1S/04JtDw3ecoCGUZeHlQbSpiCr'
          source: target/*.jar
          target: /home/github-pipeline/app/

      - name: Run Java App on Azure VM
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: '135.235.137.133'
          username: 'github-pipeline'
          key: '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'
          script: |
            pkill -f 'java -jar' || true  # stop previous instance
            nohup java -jar /home/${{ secrets.AZURE_VM_USERNAME }}/app/your-app-name.jar > app.log 2>&1 &          

#name: GitHub Actions Demo
#run-name: ${{ github.actor }} is testing out GitHub Actions ğŸš€
#on:
#  pull_request:
#    branches: [develop]
#jobs:
#  Build:
#    runs-on: ubuntu-latest
#    steps:
#      - name: Checkout repository
#        uses: actions/checkout@v4
#        with:
#          fetch-depth: 0
#      - run: ls -la
#      - name: Set up JDK 11
#        uses: actions/setup-java@v3
#        with:
#          java-version: '11'
#          distribution: 'temurin'
#          cache: maven
#      - name: Build with Maven
#        run: mvn -B package --file pom.xml
#        working-directory: ${{github.workspace}}
#  Explore-GitHub-Actions:
#    runs-on: ubuntu-latest
#    steps:
#      - run: echo "ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event."
#      - run: echo "ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"
#      - run: echo "ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
#      - name: Check out repository code
#        uses: actions/checkout@v4
#      - run: echo "ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner."
#      - run: echo "ğŸ–¥ï¸ The workflow is now ready to test your code on the runner."
#      - name: List files in the repository
#        run: |
#          ls ${{ github.workspace }}
#      - run: echo "ğŸ This job's status is ${{ job.status }}."
#  Check-Other-Action:
#    runs-on: ubuntu-latest
#    steps:
#      - run: echo "ğŸ‰ running second step"